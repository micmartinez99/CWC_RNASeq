The purpose of this code directory is to analyze the bulk RNA-Seq data generated by the 
CGI (UConn Storrs) for Dr. Giardina's lab for the CWC grant looking at the effects of walnut
supplementation on human PBMC populations. 

Previously, Dr. Giardina had anlyzed this data considering only timepoint (before vs. after), and
not taking into consideration whether a patient was a high or low producer. 
The goal of this new analysis is to consider this when doing the analysis.

The feature matrix for this anaysis was provided by Shan Kurkcu from the Giardina lab (provided on
June 25th, 2024 via Outlook emai.)

As per Shan, the raw data was processed as such: 
Tools used: fastp for trimming sequences, fastqc for quality control
Processes: Sequences were trimmed and quality checked. Minimal trimming was requires as 
			sequences were pre-processed.
QC report: Generated and aggregated using multiqc. 

Alignment: 
Tools used: HISAT2 for alignment against a reference genome
Processes: Sequences were aligned using HISAT2. SAM files were convered to sorted and compressed
			BAM files using samtools.
Alignment QC: Summarized using samtools and qualimap, aggregated in multiqc.

Counting:
Tools used: htseq-count for counting gene reads
Processes: Counts of RNA fragments mapping to each gene were generated using htseq-count. 
			This is crucial for downstream differential expression analysis
Outputs: Count files list the number of reads per gene, indicating gene expression levels.

Handling replicates in quantification:
Approaches:
	Summing: For samples with multipole biological replicates, raw counts from each replicate were summed
	to consolidate data for analysis (also did one run averaging)
	Doubling: In cases where only one replicate was available, counts were doubled to simulate the presence
	of a second replicate, ensuring consistency in data volume across samples
	Pooling: Samples were pooled at the raw fastq level before processing
	
Analysis Impact:
The combined post-count compiling was used, all yielded similar results

########################################################################################################################

Mike Maritinez analysis begins here (Monday August 5th, 2024)

Background:
A new .Rproj file was generated and stored in the CWC_RNA directory.

The bulk RNASeq data is stored in the data folder in /RNASeq/PBMC_RNASeq_Counts.csv as well as a corresponding
excel file that contains the CGI submission. Once the urolithins are stratified, I will manually make a metadata
file for DESeq2.

The samples that Shan ran for RNASeq were 
1002,
1005,
1008,
1009,
1010,
1011,
1012,
1013,
1015,
1016,
1017

First and foremost, I need to obtain information about the urolithin production status of the patients analyzed.
I will need to obtain the hydrolyzed urolithin data from Nuoxi and stratify into three groups using a Gaussian Mixture 
Model from R package mclust. The data were obtained via email from Nuoxi Fan on Monday August 5th, 2024 @ 8:50 AM. 
These are saved in the data folder under /Urolithin_Data/Hydrolyzed_urolithin_Data_Batches_1_2.csv as well as a 
corresponding excel file that is directly from Nuoxi.

The sample numbers on the urolithin data correspond to the sample numbers in the RNASeq such that RNASeq sample 1009 is 
sample 9 in the urolithins. 
V1 = Visit 1
V2 = Before Walnut
V3 = After walnut
Therefore, we are only really interested in visits 2 and 3.

First, we will need to write a code that can take the raw data and tidy it.

# Script 001_Tidy_Urolithins.R
This script takes the raw urolithin data as an input and outputs 9 individual files to the output directory.
Note: these 9 files correspond to the 9 metabolites.
These 9 files contain 5 columns (sample id, patient id, visit_2 and visit 3 quantification, and the delta values)

# Put together a cohesive dataframe that holds all 9 urolithin delta values to stratify by
This output file is called "All_Delta_Files.csv" and is in the "Outputs/001_Tidy_Urolithins/ subdirectory"

# Script 002_GMM_Classification.R
This script will classify the samples based on their profile of delta values for the 9 metabolites.
First, a PCA/biplot analysis will be conducted to determine how to best stratify the values.
Originally in our first walnut publication, we stratified solely based on urolithin A delta values
144.4, 2,792.1, and 20,656.2 ng/mg (low, medium, and high median values respectively.)



